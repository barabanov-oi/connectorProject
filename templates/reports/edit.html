{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2 class="mt-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞: {{ report_name }}</h2>
    <textarea id="jsonEditor" class="form-control" rows="15">{{ report_json }}</textarea>

    <div class="mt-3">
        <button class="btn btn-success" onclick="saveReport()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <a href="{{ url_for('reports.run_report', client_login=client_login, report_name=report_name) }}" class="btn btn-primary">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—Ç—á–µ—Ç</a>
    </div>

    <div id="statusMessage" class="mt-3"></div>
</div>

<script>
function saveReport() {
    const jsonText = document.getElementById("jsonEditor").value;
    let jsonData;

    try {
        jsonData = JSON.parse(jsonText);  // –ü—Ä–æ–≤–µ—Ä—è–µ–º JSON
    } catch (error) {
        alert("‚ùå –û—à–∏–±–∫–∞: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON!");
        return;
    }

    fetch("{{ url_for('reports.save_report', client_login=client_login, report_name=report_name) }}", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(jsonData)
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById("statusMessage").innerHTML = `<div class="alert alert-success">${data.message}</div>`;
    })
    .catch(error => {
        document.getElementById("statusMessage").innerHTML = `<div class="alert alert-danger">–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</div>`;
    });
}
</script>
{% endblock %}
